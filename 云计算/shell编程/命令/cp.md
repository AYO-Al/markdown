`cp`命令相信大家都不陌生，Linux中专门用来复制文件或目录的命令，但是平时大多都只是用来进行简单的复制操作，但其实`cp`能让复制更加多样化

## 命令格式

- `cp`有三种命令格式

  - 第一种和第二种语法用于将源文件复制到目标文件或目录
  - 第三种语法用于将多个源复制到目录

  ```bash
  cp [选项] 源 目标
  cp [选项] 源 目录
  cp [选项] 源-1 源-2 源-3 源-n 目录
  ```

- `cp`命令有三种主要模式

  - **两个文件名**：如果命令包含两个文件名，那么会将第一个文件的内容复制到第二个文件。如果第二个文件不存在会先创建文件。如果已经存在则会直接覆盖且没有任何提示，复制文件时最好带上`-i`选项提示信息，有的Linux系统会自带`alias cp=cp -i`

  - **一个或多个参数**：如果命令有一个或多个参数，指定文件名，并在这些参数之后，有一个参数指定目录名，那么此命令将每个源文件复制到具有相同名称的目标目录，如果不存在则创建，存在则覆盖。但是目录需要事先存在，否则报错

  - **两个目录名**：如果命令包含两个目录名，`cp`会将原目录的所有文件复制到目标目录，通常需要`-R`选项，需要目录存在。且会把源目录整个复制到目标目录中，如果只想用源目录中的子目录和文件，可以这样操作：

    ```bash
    cp -R a/* c/
    ```

## 完全复制

相信大家在使用`cp`命令时都会发现复制过去以后文件的权限会发生变化，这是因为`cp`在创建文件时是按照系统默认的文件权限进行创建的，所以每次复制过去之后都要手动更改权限，但是其实可以把文件完全复制过去，而不用自己手动再进行操作

- `-p`：保留文件模式、所有权和时间戳

```bash
[root@localhost test]# cp -p b.txt c.txt
-rwxrwxrwx. 1 root root  8 9月  17 11:35 b.txt
-rwxrwxrwx. 1 root root  8 9月  17 11:35 c.txt
```

## 增量复制

提到增量备份，大家一定会首先想起`rsync`这个工具，但其实`cp`命令的`-u`选项也可以实现简单的增量复制

- `-u`：只有当源文件比目标文件时间新或一样时才复制

  ```bash
  [root@localhost test]# cp -u d.txt p.txt
  -rwxr-xr-x. 1 mysql mysql  2 9月  17 12:10 d.txt
  -rwxr-xr-x. 1 mysql mysql  2 9月  17 12:10 p.txt
  ```

## 软硬链接

一般来说我们都习惯用`ln`命令来生成软硬链接，但其实用`cp`命令也可以达到相同的结果。还可以使用`-a`选项复制链接

- `-l`：生成硬链接
- `-s`：生成软链接

```bash
[root@localhost test]# cp -s a.txt ccc
lrwxrwxrwx. 1 root root  5 9月  17 15:40 ccc -> a.txt
```

## 常用选项

| 选项 | 用法                                                         |
| ---- | ------------------------------------------------------------ |
| -i   | 在覆盖目标文件之前，系统首先会警告用户。如果按下y，则覆盖该文件；任何其他选项都不会复制。 |
| -n   | 告诉`cp`不要覆盖现有的文件                                   |
| -d   | 原样复制                                                     |
| -u   | 只有当源文件比目标文件时间新或相同时才复制                   |
| -p   | 保留文件模式、所有权和时间戳                                 |
| -v   | 告诉`cp`打印详细输出                                         |
| -R   | 复制目录及其所有子目录和文件                                 |
| -a   | 等同于-dpR 或--preserve=all，它会保留链接，递归复制目录，并分别保留文件权限和所有权 |
| -f   | 如果无法打开现有的目标文件，则删除它并重试（当也使用了-n选项时，此选项将被忽略 |
| -b   | 类似于--backup                                               |
| -l   | 硬链接文件，而不是复制                                       |
| -s   | 生成符号链接                                                 |



