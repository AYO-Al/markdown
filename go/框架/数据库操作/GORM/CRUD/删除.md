删除记录时，删除的值需要有主键，否则会触发批量删除 ，例如：

```go
// Email's ID is `10`
db.Delete(&email)
// DELETE from emails where id = 10;

// Delete with additional conditions
db.Where("name = ?", "jinzhu").Delete(&email)
// DELETE from emails where id = 10 AND name = "jinzhu";
```
# 1 阻止全局删除

如果在没有任何条件的情况下执行批量删除，GORM 将不会运行它，并将返回 `ErrMissingWhereClause` 错误

必须使用一些条件或使用原始 SQL 或启用 `AllowGlobalUpdate` 模式，例如：

```go
db.Delete(&User{}).Error // gorm.ErrMissingWhereClause

db.Delete(&[]User{{Name: "jinzhu1"}, {Name: "jinzhu2"}}).Error // gorm.ErrMissingWhereClause

db.Where("1 = 1").Delete(&User{})
// DELETE FROM `users` WHERE 1=1

db.Exec("DELETE FROM users")
// DELETE FROM users

db.Session(&gorm.Session{AllowGlobalUpdate: true}).Delete(&User{})
// DELETE FROM users
```

# 2 使用主键删除

GORM 允许使用内联条件的主键删除对象，它适用于数字

```go
db.Delete(&User{}, 10)
// DELETE FROM users WHERE id = 10;

db.Delete(&User{}, "10")
// DELETE FROM users WHERE id = 10;

db.Delete(&users, []int{1,2,3})
// DELETE FROM users WHERE id IN (1,2,3);

```
# 3 批量删除

指定的值没有主值，GORM 将执行批量删除，它将删除所有匹配的记录

```go
db.Where("email LIKE ?", "%jinzhu%").Delete(&Email{})
// DELETE from emails where email LIKE "%jinzhu%";

db.Delete(&Email{}, "email LIKE ?", "%jinzhu%")
// DELETE from emails where email LIKE "%jinzhu%";
```
# 4 返回已删除的数据

返回已删除的数据，仅适用于数据库支持返回，例如：

```go
// return all columns
var users []User
DB.Clauses(clause.Returning{}).Where("role = ?", "admin").Delete(&users)
// DELETE FROM `users` WHERE role = "admin" RETURNING *
// users => []User{{ID: 1, Name: "jinzhu", Role: "admin", Salary: 100}, {ID: 2, Name: "jinzhu.2", Role: "admin", Salary: 1000}}

// return specified columns
DB.Clauses(clause.Returning{Columns: []clause.Column{{Name: "name"}, {Name: "salary"}}}).Where("role = ?", "admin").Delete(&users)
// DELETE FROM `users` WHERE role = "admin" RETURNING `name`, `salary`
// users => []User{{ID: 0, Name: "jinzhu", Role: "", Salary: 100}, {ID: 0, Name: "jinzhu.2", Role: "", Salary: 1000}}
```
# 5 软删除

如果模型包含 `gorm.DeletedAt` 字段（包含在 `gorm.Model` 中），它将自动获得软删除功能

当调用 `Delete` 时，记录不会从数据库中删除，但 GORM 会将 `DeletedAt` 的值设置为当前时间，并且无法再使用常规查询方法找到数据。

```go
// user's ID is `111`  
db.Delete(&user)  
// UPDATE users SET deleted_at="2013-10-29 10:23" WHERE id = 111;  
  
// Batch Delete  
db.Where("age = ?", 20).Delete(&User{})  
// UPDATE users SET deleted_at="2013-10-29 10:23" WHERE age = 20;  
  
// Soft deleted records will be ignored when querying  
db.Where("age = 20").Find(&user)  
// SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL;
```
## 5.1 查找软删除记录

可以使用 `Unscoped` 查找软删除的记录

```go
db.Unscoped().Where("age = 20").Find(&users)
// SELECT * FROM users WHERE age = 20;
```
## 5.2 永久删除

可以使用 `Unscoped` 永久删除匹配的记录

```go
db.Unscoped().Delete(&order)
// DELETE FROM orders WHERE id=10;
```
## 5.3 其他的删除标志

```go
import "gorm.io/plugin/soft_delete"

type User struct {
  ID    uint
  Name  string
  IsDel soft_delete.DeletedAt `gorm:"softDelete:flag"`
}

// Query
SELECT * FROM users WHERE is_del = 0;

// Delete
UPDATE users SET is_del = 1 WHERE ID = 1;


type User struct {  
  ID        uint  
  Name      string  
  DeletedAt time.Time  
  IsDel     soft_delete.DeletedAt `gorm:"softDelete:flag,DeletedAtField:DeletedAt"` // use `1` `0`  
  // IsDel     soft_delete.DeletedAt `gorm:"softDelete:,DeletedAtField:DeletedAt"` // use `unix second`  
  // IsDel     soft_delete.DeletedAt `gorm:"softDelete:nano,DeletedAtField:DeletedAt"` // use `unix nano second`  
}  
  
// Query  
SELECT * FROM users WHERE is_del = 0;  
  
// Delete  
UPDATE users SET is_del = 1, deleted_at = /* current unix second */ WHERE ID = 1;
```


# 6 函数说明

## 6.1 `func (db *DB) Delete(value interface{}, conds ...interface{}) (tx *DB)`

执行删除操作，行为取决于模型是否启用了软删除：

- 软删除模型 → 设置 `DeletedAt`时间戳
    
- 普通模型 → 物理删除记录